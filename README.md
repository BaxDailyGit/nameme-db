# 네임미 db모델링 관련 첨언


#### 1. 테이블명을 지을 때는 복수형을 사용하기! (shelter -> shelters,  volunteer -> volunteers)  
단수형으로 하면 예약어(ADD, ALL, ALTER)와 겹칠 수 있기 떄문에 복수형으로 합니다.   
(단수형으로 테이블명을 짓는 회사들도 많지만요.)(가장 중요한건 여러 시스템간의 일관성!)  


#### 2. id 타입은 int4로!  
id의 타입이 UUID인데 악의적인 사용자가 추측이 어렵고, 데이터간의 키 충돌이 발생하지 않는 장점이 있지만(but.. 그럴경우가 거의 없음) 단점이 정렬이 안되고, 용량이 커서 느립니다.   
그래서 보통은 id는 int4를 씁니다. (int2, 8은 비추천)  


#### 3. 생년월일 컬럼으로 추가하기!  
나이 컬럼은 1년이 지나면 모두 수정해줘야 하는 문제가 생깁니다.  
sql에서 타임과 생년월일 빼기 해서 나오도록 하면 됩니다. 이것을 위해 생년월일을 추가합니다.  


#### 4. 테이블에 created_at과 updated_at 컬럼 추가하기!  
DB 설계할 때 created_at과 updated_at 컬럼은 대부분 테이블에 있는것을 권장합니다. 
(특히 4개가지 테이블을 보니 변경 가능성이 높아 보여 반드시 추가하는게 좋을것 같아요.)  


#### 5. 문자는 VARCHAR(255)로!!  
이때 글자수가 고정되어있다면 255대신 고정된 글자수를 넣으면 좋습니다.  
TEXT는 매우 길어질 경우에 씁니다.(255넘어가는 경우)  
참고) 잘 사용하지 않는 데이터 타입 : CHAR, FLOAT, DOUBLE, TEXT  


#### 6. 참고) 대표사진은 대부분 클라우드 스토리지 (예를들어 aws s3)를 쓰므로 s3 url을 넣어서 관리하자! 타입은 VARCHAR(255)!  


#### 7. 질문) 등록이 되어있다면 마이크로칩 넘버가 있는건가요?  
만약 맞다면)  
등록이 안되어있다면 마이크로칩 넘버가 null로 되어있으면 될까요? db에 null인 데이터가 있으면 문제가 생기는 경우가 종종있습니다.   
이럴경우에는 등록 여부가 아닌  
마이크로칩 테이블을 따로 분리해서 관리하면 됩니다. (이때부터는 '관계'라는 개념이 살짝 들어갑니다.)  


#### 8. DB 설계할 때 가장 중요한건 "중복 없애기"!!  
중복이 있게끔 테이블을 설계하면 데이터끼리 꼬일 수 있습니다. -> DB설계 시 정규화를 하면 됩니다.  

참고로 제가 말하는 중복은 "실제 서비스에서 A 데이터의 값을 수정하면, B 데이터의 값도 같이 수정되어야 하는가?"에 해당되는것을 중복이라 추가 설명합니다. 

[예시]  
| id| 제목| 작성자|
|---|---|---|
| 1| 안녕하세요| 백승진|
| 2| 안녕하세요| 김철수|

이럴때 "1번 게시글의 제목을 수정하면, 2번 게시글의 제목도 같이 수정되어야 하는가?"
-> No! (중복아님)  

[예시]  
| id| 제목| 작성자|
|---|---|---|
| 1| 반갑습니다.| 백승진|
| 2| 잘부탁해요.| 백승진|

이럴때 "1번 게시글의 작성자 이름을 수정하면, 2번 게시글의 작성자 이름도 같이 수정되어야 하는가?"
-> Yes! (중복)  

아래 예시가 중복에 해당됩니다! 이럴때 테이블 분리를 하면 좋아요.  

#### 9. 이 서비스를 사용하는 모든 사람이 volunteer테이블에 들어있어야 할까요?  
처음 서비스를 가입한 사람 같은 경우에 users  
그리고 그 users에 role을 적용해서 shelter_admin, volunteer 이 두가지 role로 하면 좋을것 같아요.  


#### 10. animals 테이블의 컬럼에 주인id가 있다는 전제하에  
만약 반려견은 서비스에 등록되어있는데 주인은 회원가입을 하지 않아서 volunteerid가 없는 경우에는?  
null처리하면 좋을까요? 아까처럼 db에 null인 데이터가 있으면 문제가 생기는 경우가 종종있습니다.  

------------------

신경쓰는 부분이 많아 질수록 일도 많아지는것 같아 걱정도 되실텐데요.  
db설계는 정답은 없지만 처음부터 잘 설계하는게 나중에 고생을 덜 하는 방법인것 같습니다.  
그래서 처음부터 다시 설계하는것도 추천드리는데요. 순서를 적어봅니다!  

# db 모델링 순서

#### 1. 저장해야 하는 데이터 파악하기  
요구사항(기능)을 정의합니다.   
[예시]  
  - 회원가입기능 (회원가입을 할 때 이메일, 비밀번호, 이름의 정보를 받는다.)  
  - 로그인 기능 (로그인할 때 이메일, 비밀번호를 활용해서 로그인한다. )  
  - 게시글 작성 기능 (로그인한 사용자만 게시글을 작성할 수 있다.)(게시글에는 제목과 내용을 작성할 수 있다.)  
  - 게시글 조회 기능 (작성자, 게시글 제목, 게시글 내용, 게시글 작성 시간을 조회할 수 있어야 한다. )  


#### 2. 그룹핑해서 분류하기 (저장해야 하는 데이터를 묶어서 그룹핑할 수 있는 상위개념을 찾기)  
[예시]  
- 패스워드, 이름, 이메일 → 사용자 테이블  
- 게시글 제목, 게시글 내용, 게시글 생성 시간 → 게시글 테이블  


#### 3. 테이블 분리해나가기(정규화)  
- 한 칸에는 한 가지 정보만 들어가도록 만들기.  
	- 한 칸에 2개 이상의 정보가 들어가있을 땐? -> 테이블 분리  
	- 테이블 분리해도 해결안되면? -> 중간 테이블 더 만들기  
- 관계 설정하기.  
	- 1:N 관계에선 N 쪽의 테이블에 FK가 들어가야 한다.  
	- N:M 관계에선 중간 테이블이 있어야 한다. 중간 테이블에 두 테이블의 FK가 들어가야 한다.  
	- 1:1 관계는 생각보다 잘 안 나온다. 아무 테이블에 FK를 넣어도 된다. 합쳐도 되는 지 고려해봐야 한다. (어지간하면 1:1 관계로 분리하지 않는 걸 추천한다.)  

 
-승진-  
